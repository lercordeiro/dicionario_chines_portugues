%
% Funções que uso no dicionario.tex
%

\NewDocumentCommand{\mylist}{>{\SplitList{;}}m}{
  \begin{enumerate*}[left=0pt,mode=unboxed,itemjoin={{; }}]
  \ProcessList{#1}{\insertitem}
  \end{enumerate*}
}
\NewDocumentCommand{\insertitem}{m}{\item #1}

\NewDocumentEnvironment{verbete}{ o m o m o }{%
  \StrSubstitute{#4}{r5}{r}[\result]
  \StrSubstitute{\result}{t5}{t}[\pstr]
  \edef\py{\pinyin{\pstr}}
  \markboth{#2{\small«\py»}}{#2{\small«\py»}}
  \index[pinyin]{#2@«\py» #2}
  \index[stroke]{#2@#2 «\py»}
  \index[radical]{#2@#2 «\py»}
  \leavevmode\vspace{1ex}%
  \begin{minipage}[t][][t]{\linewidth}
  \begin{FlushLeft}
  \label{\mdfivesum{#2::#4}}
  {\tiny\ding{108}\Large\textbf{#2}}%
  \IfValueTF{#3}{%
    \IfValueT{#1}{\hfill\textsuperscript{\tiny(#1画)}}%
    \IfValueTF{#5}{#3«\py»#5}{#3«\py»}
  }{%
    \IfValueTF{#5}%
      {\IfValueT{#1}{\hfill\textsuperscript{\tiny(#1画)}} «\py»#5 }%
      {\hspace{1ex}«\py»\IfValueT{#1}{\hfill\textsuperscript{\tiny(#1画)}}}
  }
  \newline
}{%
  \end{FlushLeft}
  \end{minipage}
}

\NewDocumentEnvironment{verbete*}{ o m o m o }{%
  \StrSubstitute{#4}{r5}{r}[\result]
  \StrSubstitute{\result}{t5}{t}[\pstr]
  \edef\py{\pinyin{\pstr}}
  \markboth{#2{\small«\py»}}{#2{\small«\py»}}
  \index[pinyin]{#2@«\py» \textcolor{BrickRed}{#2}}
  \index[stroke]{#2@\textcolor{BrickRed}{#2} «\py»}
  \index[radical]{#2@\textcolor{BrickRed}{#2} «\py»}
  \leavevmode\vspace{1ex}%
  \begin{minipage}[t][][t]{\linewidth}
  \begin{FlushLeft}
  \label{\mdfivesum{#2::#4}}
  {\tiny\ding{110}\Large \textbf{#2}}%
  \IfValueTF{#3}{%
    \IfValueT{#1}{\hfill\textsuperscript{\tiny(#1画)}}%
    \IfValueTF{#5}{#3«\py»#5}{#3«\py»}
  }{%
    \IfValueTF{#5}%
      {\IfValueT{#1}{\hfill\textsuperscript{\tiny(#1画)}} «\py»#5}%
      {\hspace{1ex}«\py»\IfValueT{#1}{\hfill\textsuperscript{\tiny(#1画)}}}
  }
  \newline
}{%
  \end{FlushLeft}
  \end{minipage}
}

\NewDocumentCommand{\significado}{ o m m }{%
  $\hookrightarrow$\ (\textit{#2})%
  \IfValueT{#1}{{\small[p.c.:#1]}}%
  {\mylist{#3}}%
  \newline
}

\NewDocumentCommand{\veja}{ s m m }{%
  \StrSubstitute{#3}{r5}{r}[\result]
  \StrSubstitute{\result}{t5}{t}[\pstr]
  \edef\py{\pinyin{\pstr}}
  \IfBooleanTF{#1}{%
    \textsc{Veja:} #2{\footnotesize(pág.\pageref{\mdfivesum{#2::#3}})}\\%
    \hspace{7ex}{\small«\py»}%
  }{%
    \textsc{Veja:} #2{\small«\py»} {\footnotesize(pág.\pageref{\mdfivesum{#2::#3}})}%
  }%
  \newline
}


\DeclareRobustCommand{\&}{%
    \ifdim\fontdimen1\font>0pt
        \textsl{\symbol{`\&}}%
    \else
        \symbol{`\&}%
    \fi
}

