
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%                                                                     %%%%%
%%%%% pinyincmd.tex:                                                      %%%%%
%%%%% Ambientes para o Dicionário ordenado por pinyins.                   %%%%%
%%%%%                                                                     %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ExplSyntaxOn

%%% Ambiente "entry", para os verbetes
\NewDocumentEnvironment{entry}{mO{}mO{}mmooo}%
 {%
  \leavevmode
  \markboth{#1{\tiny\dpy{#3}}}{#1{\tiny\dpy{#3}}}
  \tl_set:Nn \l_hanzi_tl {#1}
  \tl_set:Nn \l_pinyin_tl {#3}
  \tl_set:Nn \l_strokes_tl {#5}
  \boolfalse{f_see}\renewcommand\seerefl{}\listadd{\seerefl}{}% Inicializa a lista
  \boolfalse{f_seealso}\renewcommand\seealsorefl{}\listadd{\seealsorefl}{}% Inicializa a lista
  \begin{minipage}[t][][t]{\entrywidth}
   \label{#1:#3}
   \StrLen{#1}[\hanzilen]
   \ifthenelse{\hanzilen > 1}
    {%
     \begin{lightbox}
      {\Large#1}\hfill\textsuperscript{\tiny(#5画)}
      \tcblower
      {\footnotesize#2\ \dpy{#3}\ #4}%
      \IfValueT{#7}{\mbox{}\hfill{\tiny#7}}{}%
      \IfValueT{#8}{\mbox{}\hfill{\tiny#8}}{}%
      \IfValueT{#9}{\mbox{}\hfill{\tiny#9}}{}%
      \mbox{}\hfill\IfSubStr{#6}{、}{\tiny Radicais\ #6}{\tiny Radical\ #6}
     \end{lightbox}
    }%
    {%
     \begin{darkbox}
      {\Large#1}\hfill\textsuperscript{\tiny(#5画)}
      \tcblower
      {\footnotesize#2\ \dpy{#3}\ #4}%
      \IfValueT{#7}{\mbox{}\hfill{\tiny#7}}{}%
      \IfValueT{#8}{\mbox{}\hfill{\tiny#8}}{}%
      \IfValueT{#9}{\mbox{}\hfill{\tiny#9}}{}%
      \mbox{}\hfill\IfSubStr{#6}{、}{\tiny Radicais\ #6}{\tiny Radical\ #6}
     \end{darkbox}
    }%
 }{%
  \ifbool{f_see}%
   {% Processa as referências "Veja"
    \RenewDocumentCommand\do{>{\SplitArgument{1}{:}}m}{\item \seeitem ##1}
    \textbf{Veja:}%
    \begin{seelist}
     \dolistloop{\seerefl}
    \end{seelist}
   }{}%
  \ifbool{f_seealso}%
   {% Processa as referências "Veja também"
    \RenewDocumentCommand\do{>{\SplitArgument{1}{:}}m}{\item \seeitem ##1}
    \textbf{Veja\ também:}%
    \begin{seealsolist}
     \dolistloop{\seealsorefl}
    \end{seealsolist}
   }{}%
  \end{minipage}
}

%%% Ambiente "entry*", para os verbetes muito compridos
\NewDocumentEnvironment{entry*}{mO{}mO{}mmooo}
 {%
  \leavevmode
  \markboth{#1{\tiny\dpy{#3}}}{#1{\tiny\dpy{#3}}}
  \tl_set:Nn \l_hanzi_tl {#1}
  \tl_set:Nn \l_pinyin_tl {#3}
  \tl_set:Nn \l_strokes_tl {#5}
  \boolfalse{f_see} \renewcommand\seerefl{} \listadd{\seerefl}{}% Inicializa a lista
  \boolfalse{f_seealso} \renewcommand\seealsorefl{} \listadd{\seealsorefl}{}% Inicializa a lista
  \begin{minipage}[t][][t]{\entrywidth}
   \label{#1:#3}
   \begin{lightbox}
    \mbox{}\hfill\textsuperscript{\tiny(#5画)}\\
    {\LARGE#1}
    \tcblower
    {\footnotesize#2\ \dpy{#3}\ #4}\\
    \IfValueT{#7}{\mbox{}\hfill{\tiny#7}}{}%
    \IfValueT{#8}{\mbox{}\hfill{\tiny#8}}{}%
    \IfValueT{#9}{\mbox{}\hfill{\tiny#9}}{}%
    \mbox{}\hfill\IfSubStr{#6}{、}{\tiny Radicais\ #6}{\tiny Radical\ #6}                                      
   \end{lightbox}
 }%
 {%
  \ifbool{f_see}%
   {% Processa as referências "Veja"
    \RenewDocumentCommand\do{>{\SplitArgument{1}{:}}m}{\item \seeitem ##1}
    \textbf{Veja:}%
    \begin{seelist}
     \dolistloop{\seerefl}
    \end{seelist}
   }{}%
  \ifbool{f_seealso}%
   {% Processa as referências "Veja também"
    \RenewDocumentCommand\do{>{\SplitArgument{1}{:}}m}{\item \seeitem ##1}
    \textbf{Veja\ também:}%
    \begin{seealsolist}
     \dolistloop{\seealsorefl}
    \end{seealsolist}
   }{}%
  \end{minipage}
}

\ExplSyntaxOff

%%%%% EOF %%%%%
