%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%                                                                     %%%%%
%%%%% strokescmd.tex:                                                     %%%%%
%%%%% Ambientes para o Dicionário ordenado por traços.                    %%%%%
%%%%%                                                                     %%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ExplSyntaxOn

%%% Ambiente "entry", para os verbetes
\NewDocumentEnvironment{entry}{mmmooo}%
 {%
  \leavevmode
  \markboth{#1{\tiny(#3)}}{#1{\tiny(#3)}}
  \tl_set:Nn \l_hanzi_tl {#1}
  \tl_set:Nn \l_strokes_tl {#2}
  \begin{minipage}[t][][t]{\entrywidth}
   \StrLen{#1}[\hanzilen]
   \ifthenelse{\hanzilen > 1}
    {%
     \begin{lightbox}
      {\LARGE#1}\hfill\textsuperscript{\tiny(#2画)}
      \tcblower
      \IfValueT{#4}{\mbox{}\hfill{\tiny#4}}{}%
      \IfValueT{#5}{\mbox{}\hfill{\tiny#5}}{}%
      \IfValueT{#5}{\mbox{}\hfill{\tiny#6}}{}%
      \mbox{}\hfill\IfSubStr{#3}{、}{\tiny Radicais\ #3}{\tiny Radical\ #3}
     \end{lightbox}
    }%
    {%
     \begin{darkbox}
      {\LARGE#1}\hfill\textsuperscript{\tiny(#2画)}
      \tcblower
      \IfValueT{#4}{\mbox{}\hfill{\tiny#4}}{}%
      \IfValueT{#5}{\mbox{}\hfill{\tiny#5}}{}%
      \IfValueT{#5}{\mbox{}\hfill{\tiny#6}}{}%
      \mbox{}\hfill\IfSubStr{#3}{、}{\tiny Radicais\ #3}{\tiny Radical\ #3}
     \end{darkbox}
    }
 }%
 {%
  \end{minipage}
 }

%%% Ambiente "entry*", para os verbetes muito compridos
\NewDocumentEnvironment{entry*}{mmmooo}%
 {%
  \leavevmode
  \markboth{#1{\tiny(#3)}}{#1{\tiny(#3)}}
  \tl_set:Nn \l_hanzi_tl {#1}
  \tl_set:Nn \l_strokes_tl {#2}
  \begin{minipage}[t][][t]{\entrywidth}
   \begin{lightbox}
    \mbox{}\hfill\textsuperscript{\tiny(#2画)}\\
    {\LARGE#1}
    \tcblower
    \IfValueT{#4}{\mbox{}\hfill{\tiny#4}}{}%
    \IfValueT{#5}{\mbox{}\hfill{\tiny#5}}{}%
    \IfValueT{#6}{\mbox{}\hfill{\tiny#6}}{}%
    \mbox{}\hfill\IfSubStr{#3}{、}{\tiny Radicais\ #3}{\tiny Radical\ #3}
   \end{lightbox}
 }%
 {%
  \end{minipage}
 }

%%% Ambiente "phonetics", para as diversas entradas de fonética da palavra
\NewDocumentEnvironment{phonetics}{mO{}mO{}O{}}%
 {%
  \tl_set:Nn \l_pinyin_tl {#3}
  \boolfalse{f_see} \renewcommand\seerefl{} \listadd{\seerefl}{}% Inicializa a lista
  \boolfalse{f_seealso} \renewcommand\seealsorefl{} \listadd{\seealsorefl}{}% Inicializa a lista
  \label{#1:#3}
  \ding{93}\ #2\ \dpy{#3}\ #4\ \ding{93}\hfill \textbf{#5}\\
 }
 {%  
  \ifbool{f_see}%
   {% Processa as referências "Veja"
    \RenewDocumentCommand\do{>{\SplitArgument{1}{:}}m}{\item \seeitem ##1}
    \textbf{Veja:}%
    \begin{seelist}
     \dolistloop{\seerefl}
    \end{seelist}
   }{}%
  \ifbool{f_seealso}%
   {% Processa as referências "Veja também"
    \RenewDocumentCommand\do{>{\SplitArgument{1}{:}}m}{\item \seeitem ##1}
    \textbf{Veja\ também:}%
    \begin{seealsolist}
     \dolistloop{\seealsorefl}
    \end{seealsolist}
   }{}%
 }

\ExplSyntaxOff

%%%%% EOF %%%%%
