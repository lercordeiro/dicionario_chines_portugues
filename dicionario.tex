%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% XeTeX
%
% Dicionário Chinês -> Português
% Autor: Luiz Eduardo Roncato Cordeiro
%
% Licença:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\documentclass[a4paper,12pt,twoside,openany,draft]{memoir}
\documentclass[a4paper,12pt,twoside,openany]{memoir}

\usepackage[usenames,dvipsnames]{color}
\usepackage[utf8]{inputenc}
\usepackage[brazil]{babel}
\usepackage{fontspec}
\usepackage{xeCJK}
\usepackage{xpinyin}
\usepackage{xunicode}
\usepackage{xltxtra}
\usepackage{multicol}
\usepackage{fancyhdr}
\usepackage{imakeidx}
\usepackage{ifthen}
\usepackage{tocloft}
\usepackage{xparse}
\usepackage[inline]{enumitem}
\usepackage{zhnumber}
\usepackage{wasysym}
\usepackage{ragged2e}
\usepackage[explicit]{titlesec}
\usepackage{tikz}
\usepackage[hyperindex,hidelinks]{hyperref}

\hypersetup{
  linktoc=page,
  colorlinks=true,
  urlcolor=blue,
  linkcolor=blue,
  citecolor=red,
  pdftitle={汉葡词典- Dicionário Chinês-Português},
  pdfsubject={Dicionário Chinês-Português para o Curso de Chinês do Instituto Confúcio},
  pdfauthor={Luiz Eduardo Roncato Cordeiro (罗学凯)},
  pdfkeywords={dicionário, chinês, português}
}

%\setCJKmainfont{Noto Serif CJK SC}
%\setCJKsansfont{Noto Sans CJK SC}

\setCJKmainfont{AR PL New Kai}
\setCJKsansfont{AR PL SungtiL GB}

\makeindex[columns=3, title=Índice, intoc]

\setlength{\parindent}{0em}
\setlength{\parskip}{0.5em}
\setlength{\columnsep}{1em}
\setlength{\columnseprule}{0.2mm}

\xpinyinsetup{ratio={.6},vsep={1.2em}}

% Headers & footers
\fancyhead[L]{\rightmark} % Top left header
\fancyhead[R]{\leftmark}  % Top right header
\renewcommand{\headrulewidth}{1.4pt} % Rule under the header
\fancyfoot[C]{\thepage} % Bottom center footer
\renewcommand{\footrulewidth}{1.4pt} % Rule under the header
\pagestyle{fancy} % Use the custom headers and footers throughout the document

\setlength{\headheight}{16pt}
\addtolength{\topmargin}{-0.5pt}

\NewDocumentCommand\mylist{>{\SplitList{;}}m}{
  \begin{enumerate*}[left=0pt,mode=unboxed,itemjoin={{; }}]
  \ProcessList{#1}{\insertitem}
  \end{enumerate*}
}
\newcommand\insertitem[1]{\item #1}

\DeclareDocumentEnvironment{verbete}{ o m o m o }{%
  \leavevmode\vspace{1ex}%
  \markboth{#2{\small«\pinyin{#4}»}}{#2{\small«\pinyin{#4}»}}
  \index{#2 «\pinyin{#4}»}
  \begin{minipage}[t][][t]{\linewidth}%
  \begin{FlushLeft}%
  {\Large$\bullet$ \textbf{#2}}%
  \label{\mdfivesum{#2::#4}}%
  \IfValueTF{#3}{%
    \IfValueT{#1}{\hfill\textsuperscript{\tiny(#1画)}}%
    \IfValueTF{#5}{%
      {#3}{«\pinyin{#4}»}{#5}%
    }{%
      {#3}{«\pinyin{#4}»}%
    }
  }{%
    \IfValueTF{#5}{%
      \IfValueT{#1}{\hfill\textsuperscript{\tiny(#1画)}}%
      { «\pinyin{#4}»}{#5}%
    }{%
      { «\pinyin{#4}»}\IfValueT{#1}{\hfill\textsuperscript{\tiny(#1画)}}%
    }
  }%
  \newline
}{%
  \end{FlushLeft}%
  \end{minipage}
}

\DeclareDocumentCommand{\significado}{ o m m }{%
  $\hookrightarrow$\ (\textit{#2})%
  \IfValueT{#1}{{ [p.c.:#1]}}%
  {\mylist{#3}}%
  \newline
}

\DeclareDocumentCommand{\veja}{ s m m }{%
  \IfBooleanTF{#1}{%
    \textsc{Veja:} #2{\footnotesize(pág. \pageref{\mdfivesum{#2::#3}})}\\%
    \hspace{7ex}{\small«\pinyin{#3}»}%
  }{%
    \textsc{Veja:} #2{\small«\pinyin{#3}»} {\footnotesize(pág. \pageref{\mdfivesum{#2::#3}})}%
  }%
  \newline
}

\newcommand{\p}[1]{«\pinyin{#1}»}
\newcommand{\e}[1]{\textcolor{OliveGreen}{#1}}

\makeatletter
\let\old@makechapterhead\@makechapterhead
% Taken from http://mirrors.ctan.org/macros/latex/unpacked/report.cls
\def\fake@makechapterhead#1{%
  \vspace*{50\p@}%
  {\parindent \z@ \raggedright \normalfont
    \ifnum \c@secnumdepth >\m@ne
        \huge\bfseries \strut%\@chapapp\space \thechapter
        \par\nobreak
        \vskip 20\p@
    \fi
    \interlinepenalty\@M
    \Huge \bfseries #1\par\nobreak
    \vskip 40\p@
  }
  \markboth{#1}{\thechapter}
}
\newcommand{\newchapterhead}{\let\@makechapterhead\fake@makechapterhead}
\newcommand{\restorechapterhead}{\let\@makechapterhead\old@makechapterhead}
\makeatother

\DeclareRobustCommand{\&}{%
    \ifdim\fontdimen1\font>0pt
        \textsl{\symbol{`\&}}%
    \else
        \symbol{`\&}%
    \fi
}

\titlespacing{\section}{0pc}{2ex}{-1ex}
\titleformat{\section}[hang]{\Large\bfseries}{}{0pt}{%
  \tikz{%
    \node[draw,rounded corners=1mm,text depth=0.2ex,line width=1pt,    anchor=west]{\Large\bfseries#1};
  }%
}

%%%
%%% Documento começa aqui!
%%%

\begin{document}

\newchapterhead

\begin{titlingpage}
	
	\raggedleft
	
	\rule{1pt}{\textheight}
	\hspace{0.05\textwidth}
	\parbox[b]{0.75\textwidth}{
		
		{\Huge\bfseries 汉葡词典}\\[2\baselineskip] % Title
		{\large\textsc{Dicionário Chinês-Português para o\\%
     Curso de Chinês do Instituto Confúcio}}\\%
     [4\baselineskip]
    {\Large\textsc{罗学凯}\\%
     \tiny Luiz Eduardo Roncato Cordeiro\\%
     Aluno do Instituto Confúcio da UNESP}
		
		\vspace{0.5\textheight}
		
		{\noindent \zhtoday}\\[\baselineskip]
	}

\end{titlingpage}

\tableofcontents

\newpage

\chapter{Termos Gramaticais Chineses}

\begin{tabular}{lll}
substantivo/nome       & \textbf{s.}        & 名词 \\
palavra de lugar       & \textbf{p.d.l.}    & 处所词 \\
palavra de localização & \textbf{p.l.}      & 方位词 \\
palavra de tempo       & \textbf{p.t.}      & 时间词 \\
verbo                  & \textbf{v.}        & 动词 \\
verbo direcional       & \textbf{v.d.}      & 趣向\hspace{1em}动词 \\
verbo optativo         & \textbf{v.o.}      & 能缘\hspace{1em}动词 \\
adjetivo               & \textbf{adj.}      & 形容词 \\
numeral                & \textbf{num.}      & 数词 \\
palavra classificadora & \textbf{p.c.}      & 两量词 \\
pronome                & \textbf{pron.}     & 代词 \\
interrogativo          & \textbf{interr.}   & 疑问词 \\
advérbio               & \textbf{adv.}      & 副词 \\
preposição             & \textbf{prep.}     & 介词 \\
conjunção              & \textbf{conj.}     & 连词 \\
partícula              & \textbf{part.}     & 助词 \\
sujeito                & \textbf{suj.}      & 主语 \\
objeto                 & \textbf{obj.}      & 宾语 \\
atributo               & \textbf{atrib.}    & 定语 \\
adjunto adverbial      & \textbf{a.adv.}    & 状语 \\
complemento            & \textbf{compl.}    & 补语 \\
verbo+complemento      & \textbf{v.+compl.} & 动宾式\hspace{1em}离合词 \\
expressão idiomática   & \textbf{expr.}     & \\
interjeição            & \textbf{interj.}   & \\
\end{tabular}

\newpage

\chapter{汉葡词典}

%%%
%%% Estou ordenando as palavras em ordem alfabética por pinyin.
%%% Obs: Para as palavras diferentes com o mesmo pinyin, a que tem o menor 
%%%      número de traços no primeiro hanzi vem antes.
%%%

%%%%%%%%%%%%%%%%%%%%%%%%
% Entrada de um verbete:
%
% \begin{verbete}[traços]{hanzi}[antes]{pronúncia}[depois]
%   \significado[classificadores]{termo_gramatical}{lista_de_significados}
%   \veja{hanzi}{pronúncia}
% \end{verbete}
%
% Podem haver quantos '\significado' e '\veja' dentro de cada bloco de verbete. 
%
% Preferivelmente usar um comando '\significado' para cada termo gramatical ou
%  se houver classificadores específicos para cada significado da palavra.
%
% Podem haver vários comandos '\veja', é aconselhável usar um comando para cada
%  par de hanzy_pronúncia, o sistema cuida do texto e de colocar o número da
%  página automaticamente.
%
%
% Para o environment verbetes
%   Campos Obrigatórios
%     hanzi: Hanzi da palavra
%     pronúncia: pinyin no formato: "ma0", "ma1", "ma2", "ma3", "ma4",
%                os números correspondem aos tons
%   Campos Opcionais
%     traços: número de traços dos caracteres separados por ';'
%     antes: texto adicionado antes do texto da pronúncia
%            se adiciona um '\\' (pula linha) caso a pronúncia
%            fique por cima do texto do número de caracteres,
%            se usado o texto da pronúncia vai para baixo do Hanzi
%     depois: texto adicionado depois do texto da pronúncia,
%             se usado o texto da pronúncia vai para baixo do Hanzi
%
%
% Para o comando \significado:
%   Campos Obrigatórios
%     termo_gramatical: abreviação dos termos, como 's.', 'v.', 'adj.',
%                       'adv.', etc, conforme tabela acima
%     lista_de_significados: significados da palavra separados por ';' ou ','.
%                            Quando se usa ';' os significados são automaticamente
%                            colocados em uma sequência numérica
%   Campos Opcionais
%     classificadores: quando há, lista de classificadores separados por ',',
%                      o sistema adiciona o texto automaticamente
%
%
% Para o comando \veja:
%   Campos Obrigatórios
%     hanzi: hanzi da palavra
%     pronúncia: pinyin da pronúncia da palavra como em verbetes
%
%
% Para o comando \veja*:
%   Campos Obrigatórios
%     hanzi: hanzi da palavra
%     pronúncia: pinyin da pronúncia da palavra como em verbetes
%  Observação: Este comando joga o pinyin para a linha de baixo,
%              para evitar quebra e deixar mais bonito.
%
% Alguns exemplos de alguns de entradas de verbetes:
%
% \begin{verbete}[4]{不}[\\]{bu2}[ (antes de quarto tom)]
%   \significado{adv.}{não}
%   \veja{不}{bu0}
%   \veja{不}{bu4}
% \end{verbete}
%
% \begin{verbete}[4;6;11]{飞机票}{fei1ji1piao4}
%   \significado[张]{v.}{bilhete de avião}
%   \veja{机票}{ji1piao4}
% \end{verbete}
%
% \begin{verbete}[16;4]{餐厅}{can1ting1}
%   \significado[家]{s.}{restaurante}
%   \significado[间]{s.}{sala de jantar}
% \end{verbete}
%
% \begin{verbete}[9]{重}{chong2}
%   \significado{adv.}{de novo}
%   \significado{p.c.}{camadas}
%   \significado{s.}{repetição}
%   \significado{v.}{repetir}
%   \veja{重}{zhong4}
% \end{verbete}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearpage
\begin{multicols}{2}
\input{verbetes/A.tex}
\input{verbetes/B.tex}
\input{verbetes/C.tex}
\input{verbetes/D.tex}
\input{verbetes/E.tex}
\input{verbetes/F.tex}
\input{verbetes/G.tex}
\input{verbetes/H.tex}
%%%%% Não existem palavras com pinyin iniciado em "I"
\input{verbetes/J.tex}
\input{verbetes/K.tex}
\input{verbetes/L.tex}
\input{verbetes/M.tex}
\input{verbetes/N.tex}
\input{verbetes/O.tex}
\input{verbetes/P.tex}
\input{verbetes/Q.tex}
\input{verbetes/R.tex}
\input{verbetes/S.tex}
\input{verbetes/T.tex}
%%%%% Não existem palavras com pinyin iniciado em "U"
%%%%% Não existem palavras com pinyin iniciado em "V"
\input{verbetes/W.tex}
\input{verbetes/X.tex}
\input{verbetes/Y.tex}
\input{verbetes/Z.tex}
\end{multicols}

\printindex

\end{document}
