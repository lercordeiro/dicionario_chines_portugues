%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% XeTeX
%
% Dicionário Chinês -> Português
% Autor: Luiz Eduardo Roncato Cordeiro
%
% Licença:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\documentclass[a4paper,12pt,twoside,openany,draft]{memoir}
\documentclass[a4paper,12pt,twoside,openany]{memoir}

\usepackage[usenames,dvipsnames]{color}
\usepackage[utf8]{inputenc}
\usepackage[brazil]{babel}
\usepackage{fontspec}
\usepackage{xltxtra}
\usepackage{xeCJK}
\usepackage{xpinyin}
\usepackage{xunicode}
\usepackage{xltxtra}
\usepackage{multicol}
\usepackage{fancyhdr}
\usepackage{imakeidx}
\usepackage{ifthen}
\usepackage{tocloft}
\usepackage{xparse}
\usepackage[inline]{enumitem}
\usepackage{zhnumber}
\usepackage{wasysym}
\usepackage{ragged2e}
\usepackage[explicit]{titlesec}
\usepackage{tikz}
\usepackage[hyperindex,hidelinks]{hyperref}

\hypersetup{
linktoc=page,
colorlinks=true,
urlcolor=blue,
linkcolor=blue,
citecolor=red
}

\setCJKmainfont{Noto Serif CJK SC}
\setCJKsansfont{Noto Sans CJK SC}

%\setCJKmainfont{AR PL UKai CN}
%\setCJKsansfont{AR PL UMing CN}

\makeindex[columns=3, title=Índice, intoc]

\setlength{\parindent}{0em}
\setlength{\parskip}{0.5em}
\setlength{\columnsep}{1em}
\setlength{\columnseprule}{0.2mm}

\xpinyinsetup{ratio={.6},vsep={1.2em}}

% Headers & footers
\fancyhead[L]{\rightmark} % Top left header
\fancyhead[R]{\leftmark}  % Top right header
\renewcommand{\headrulewidth}{1.4pt} % Rule under the header
\fancyfoot[C]{\thepage} % Bottom center footer
\renewcommand{\footrulewidth}{1.4pt} % Rule under the header
\pagestyle{fancy} % Use the custom headers and footers throughout the document

\setlength{\headheight}{16pt}
\addtolength{\topmargin}{-0.5pt}

\NewDocumentCommand\mylist{>{\SplitList{;}}m}{
  \begin{enumerate*}[left=0pt,mode=unboxed,itemjoin={{; }}]
  \ProcessList{#1}{\insertitem}
  \end{enumerate*}
}
\newcommand\insertitem[1]{\item #1}

\DeclareDocumentEnvironment{verbete}{ o m o m o }{%
  \leavevmode\vspace{-2ex}%
  \markboth{#2{\small«\pinyin{#4}»}}{#2{\small«\pinyin{#4}»}}
  \index{#2«\pinyin{#4}»}
  \begin{minipage}[t][][t]{\linewidth}%
  {\Large$\bullet$ \textbf{#2}}%
  \label{\mdfivesum{#2::#4}}%
  \IfValueTF{#3}{%
    \IfValueT{#1}{\hfill\textsuperscript{\tiny(#1画)}}%
    \IfValueTF{#5}{%
      {#3}{«\pinyin{#4}»}{#5}%
    }{%
      {#3}{«\pinyin{#4}»}%
    }
  }{%
    \IfValueTF{#5}{%
      \IfValueT{#1}{\hfill\textsuperscript{\tiny(#1画)}}%
      { «\pinyin{#4}»}{#5}%
    }{%
      { «\pinyin{#4}»}\IfValueT{#1}{\hfill\textsuperscript{\tiny(#1画)}}%
    }
  }%
  \newline
}{%
  \end{minipage}
}

\DeclareDocumentCommand{\significado}{ o m m }{%
  $\hookrightarrow$\ (\textit{#2})%
  \IfValueT{#1}{{ [p.c.:#1]}}%
  {\mylist{#3}}%
  \newline
}

\DeclareDocumentCommand{\veja}{ m m }{%
  $\hookrightarrow$\ Veja: #1«\pinyin{#2}» na pág. \pageref{\mdfivesum{#1::#2}}\newline%
}

\newcommand{\p}[1]{«\pinyin{#1}»}
\newcommand{\e}[1]{\textcolor{OliveGreen}{#1}}

\makeatletter
\let\old@makechapterhead\@makechapterhead
% Taken from http://mirrors.ctan.org/macros/latex/unpacked/report.cls
\def\fake@makechapterhead#1{%
  \vspace*{50\p@}%
  {\parindent \z@ \raggedright \normalfont
    \ifnum \c@secnumdepth >\m@ne
        \huge\bfseries \strut%\@chapapp\space \thechapter
        \par\nobreak
        \vskip 20\p@
    \fi
    \interlinepenalty\@M
    \Huge \bfseries #1\par\nobreak
    \vskip 40\p@
  }
  \markboth{#1}{\thechapter}
}
\newcommand{\newchapterhead}{\let\@makechapterhead\fake@makechapterhead}
\newcommand{\restorechapterhead}{\let\@makechapterhead\old@makechapterhead}
\makeatother

\DeclareRobustCommand{\&}{%
    \ifdim\fontdimen1\font>0pt
        \textsl{\symbol{`\&}}%
    \else
        \symbol{`\&}%
    \fi
}

\titlespacing{\section}{0pc}{2ex}{-1ex}
\titleformat{\section}[hang]{\Large\bfseries}{}{0pt}{%
  \tikz{%
    \node[draw,rounded corners=1mm,text depth=0.2ex,line width=1pt,    anchor=west]{\Large\bfseries#1};
  }%
}

%%%
%%% Documento começa aqui!
%%%

\begin{document}

\newchapterhead

\begin{titlingpage}
	
	\raggedleft
	
	\rule{1pt}{\textheight}
	\hspace{0.05\textwidth}
	\parbox[b]{0.75\textwidth}{
		
		{\Huge\bfseries 汉葡词典}\\[2\baselineskip] % Title
		{\large\textsc{Dicionário Chinês-Português para o\\%
     Curso de Chinês do Instituto Confúcio}}\\%
     [4\baselineskip]
    {\Large\textsc{罗学凯}\\%
     \tiny Luiz Eduardo Roncato Cordeiro\\%
     Aluno do Instituto Confúcio da UNESP}
		
		\vspace{0.5\textheight}
		
		{\noindent \zhtoday}\\[\baselineskip]
	}

\end{titlingpage}

\tableofcontents

\newpage

\chapter{Termos Gramaticais Chineses}

\begin{tabular}{lll}
substantivo/nome       & \textbf{s.}        & 名词 \\
palavra de lugar       & \textbf{p.d.l.}    & 处所词 \\
palavra de localização & \textbf{p.l.}      & 方位词 \\
palavra de tempo       & \textbf{p.t.}      & 时间词 \\
verbo                  & \textbf{v.}        & 动词 \\
verbo direcional       & \textbf{v.d.}      & 趣向\hspace{1em}动词 \\
verbo optativo         & \textbf{v.o.}      & 能缘\hspace{1em}动词 \\
adjetivo               & \textbf{adj.}      & 形容词 \\
numeral                & \textbf{num.}      & 数词 \\
palavra classificadora  & \textbf{p.c.}      & 两量词 \\
pronome                & \textbf{pron.}     & 代词 \\
interrogativo          & \textbf{interr.}   & 疑问词 \\
advérbio               & \textbf{adv.}      & 副词 \\
preposição             & \textbf{prep.}     & 介词 \\
conjunção              & \textbf{conj.}     & 连词 \\
partícula              & \textbf{part.}     & 助词 \\
sujeito                & \textbf{suj.}      & 主语 \\
objeto                 & \textbf{obj.}      & 宾语 \\
atributo               & \textbf{atrib.}    & 定语 \\
adjunto adverbial      & \textbf{a.adv.}    & 状语 \\
complemento            & \textbf{compl.}    & 补语 \\
verbo+complemento      & \textbf{v.+compl.} & 动宾式\hspace{1em}离合词 \\
expressão idiomática   & \textbf{expr.}     & \\
interjeição            & \textbf{interj.}   & \\
\end{tabular}

\newpage

\chapter{汉葡词典}

%%%
%%% Estou ordenando as palavras em ordem alfabética por pinyin.
%%% Obs: Para as palavras diferentes com o mesmo pinyin, a que tem o menor 
%%%      número de traços vem antes.
%%%

\clearpage
\begin{multicols}{2}
\input{verbetes/A.tex}
\input{verbetes/B.tex}
\input{verbetes/C.tex}
\input{verbetes/D.tex}
\input{verbetes/E.tex}
\input{verbetes/F.tex}
\input{verbetes/G.tex}
\input{verbetes/H.tex}
%%%%% Não existem palavras com pinyin iniciado em "I"
\input{verbetes/J.tex}
\input{verbetes/K.tex}
\input{verbetes/L.tex}
\input{verbetes/M.tex}
\input{verbetes/N.tex}
\input{verbetes/O.tex}
\input{verbetes/P.tex}
\input{verbetes/Q.tex}
\input{verbetes/R.tex}
\input{verbetes/S.tex}
\input{verbetes/T.tex}
%%%%% Não existem palavras com pinyin iniciado em "U"
%%%%% Não existem palavras com pinyin iniciado em "V"
\input{verbetes/W.tex}
\input{verbetes/X.tex}
\input{verbetes/Y.tex}
\input{verbetes/Z.tex}
\end{multicols}

\printindex

\end{document}
